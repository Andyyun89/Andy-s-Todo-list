<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Friends Style Tasks</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        /* 기존 영문 폰트 (손글씨 느낌의 Gabriel Weiss 대체용) */
        @import url('https://fonts.googleapis.com/css2?family=Gloria+Hallelujah&display=swap');
        /* 목록용 나눔고딕 폰트 */
        @import url('https://fonts.googleapis.com/css2?family=Nanum+Gothic:wght@400;700;800&display=swap');

        /* 타이틀 폰트 */
        .friends-font { font-family: 'Gloria Hallelujah', cursive; }
        
        /* 할 일 목록 텍스트 전용 클래스 */
        .todo-text { font-family: 'Nanum Gothic', sans-serif; }

        .drag-over { opacity: 0.5; }
        /* 스크롤바 커스텀 */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: rgba(122, 92, 157, 0.3); border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: rgba(122, 92, 157, 0.6); }
    </style>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        friends: {
                            purple: '#7a5c9d', // Monica's Door
                            yellow: '#f4d35e', // Peephole Frame
                            red: '#e2492f',    // Logo / Central Perk
                            ink: '#2d2d2d',
                            paper: '#fdfbf7',  // Creamy White
                            bg: '#e3dceb'      // Soft Purple BG
                        }
                    }
                }
            }
        }
    </script>
</head>
<body class="min-h-screen flex items-center justify-center text-friends-ink selection:bg-friends-yellow selection:text-friends-ink transition-all duration-500 bg-cover bg-center bg-no-repeat bg-fixed" id="app-body">

    <div id="root" class="w-full max-w-md p-4"></div>

    <script type="text/babel">
        const { useState, useRef, useEffect } = React;

        const Icons = {
            Plus: ({size=24}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>,
            Trash: ({size=24}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>,
            Check: ({size=24}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="4" strokeLinecap="round" strokeLinejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>,
            Clock: ({size=24}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>,
            Grip: ({size=24}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="9" cy="12" r="1"></circle><circle cx="9" cy="5" r="1"></circle><circle cx="9" cy="19" r="1"></circle><circle cx="15" cy="12" r="1"></circle><circle cx="15" cy="5" r="1"></circle><circle cx="15" cy="19" r="1"></circle></svg>,
            Calendar: ({size=24}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>,
            Refresh: ({size=24}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M23 4v6h-6"></path><path d="M1 20v-6h6"></path><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path></svg>,
            Download: ({size=20}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>,
            Upload: ({size=20}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>,
            Image: ({size=20}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="18" height="18" x="3" y="3" rx="2" ry="2"/><circle cx="9" cy="9" r="2"/><path d="m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"/></svg>,
            Coffee: ({size=32}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M18 8h1a4 4 0 0 1 0 8h-1"/><path d="M2 8h16v9a4 4 0 0 1-4 4H6a4 4 0 0 1-4-4V8z"/><line x1="6" y1="1" x2="6" y2="4"/><line x1="10" y1="1" x2="10" y2="4"/><line x1="14" y1="1" x2="14" y2="4"/></svg>
        };

        const INITIAL_TODOS = [
            { id: 1, text: "센트럴 퍼크에서 커피 마시기", deadline: "2024-10-25", completed: false },
            { id: 3, text: "조이와 피자 먹기", deadline: "2024-10-31", completed: false },
            { id: 2, text: "챈들러 농담에 웃어주기", deadline: "2024-10-26", completed: true },
        ];

        function App() {
            const [todos, setTodos] = useState(() => {
                const saved = localStorage.getItem('friends_todos');
                return saved ? JSON.parse(saved) : INITIAL_TODOS;
            });
            
            const [bgImage, setBgImage] = useState(() => {
                return localStorage.getItem('friends_bg_image') || null;
            });

            const [inputText, setInputText] = useState("");
            const [deadline, setDeadline] = useState("");
            
            const fileInputRef = useRef(null);
            const bgInputRef = useRef(null);
            const dragItem = useRef(null);
            const dragOverItem = useRef(null);

            useEffect(() => {
                localStorage.setItem('friends_todos', JSON.stringify(todos));
            }, [todos]);

            useEffect(() => {
                const body = document.getElementById('app-body');
                if (bgImage) {
                    body.style.backgroundImage = `url('${bgImage}')`;
                    body.style.backgroundColor = '#2d2d2d'; 
                } else {
                    body.style.backgroundImage = 'none';
                    // Monica's Apartment Purple Tone
                    body.style.backgroundColor = '#e3dceb'; 
                }
                localStorage.setItem('friends_bg_image', bgImage || '');
            }, [bgImage]);

            const addTodo = (e) => {
                e.preventDefault();
                if (!inputText.trim()) return;
                const newTodo = { id: Date.now(), text: inputText, deadline: deadline, completed: false };
                setTodos([newTodo, ...todos]);
                setInputText("");
                setDeadline("");
            };

            const toggleComplete = (id) => {
                setTodos(todos.map(todo => todo.id === id ? { ...todo, completed: !todo.completed } : todo));
            };

            const deleteTodo = (id) => {
                if(confirm('삭제하시겠습니까?')) {
                    setTodos(todos.filter(todo => todo.id !== id));
                }
            };

            const resetData = () => {
                if(confirm('초기화하시겠습니까?')) {
                    setTodos(INITIAL_TODOS);
                    setBgImage(null);
                }
            };

            const exportData = () => {
                const dataStr = JSON.stringify(todos);
                const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
                const exportFileDefaultName = `friends_todo_${new Date().toISOString().slice(0,10)}.json`;
                const linkElement = document.createElement('a');
                linkElement.setAttribute('href', dataUri);
                linkElement.setAttribute('download', exportFileDefaultName);
                linkElement.click();
            };

            const importData = (e) => {
                const fileReader = new FileReader();
                if(e.target.files[0]){
                    fileReader.readAsText(e.target.files[0], "UTF-8");
                    fileReader.onload = (event) => {
                        try {
                            const loadedTodos = JSON.parse(event.target.result);
                            if(Array.isArray(loadedTodos)) {
                                if(confirm('불러오시겠습니까?')) setTodos(loadedTodos);
                            } else {
                                alert('파일 형식이 올바르지 않습니다.');
                            }
                        } catch (err) {
                            alert('오류가 발생했습니다.');
                        }
                    };
                }
                e.target.value = null; 
            };

            const handleBgUpload = (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onloadend = () => setBgImage(reader.result);
                    reader.readAsDataURL(file);
                }
                e.target.value = null;
            };

            const handleDragStart = (e, index) => { dragItem.current = index; };
            const handleDragEnter = (e, index) => { dragOverItem.current = index; };
            const handleDragEnd = () => {
                if (dragItem.current !== null && dragOverItem.current !== null) {
                    const _todos = [...todos];
                    const draggedItemContent = _todos.splice(dragItem.current, 1)[0];
                    _todos.splice(dragOverItem.current, 0, draggedItemContent);
                    setTodos(_todos);
                }
                dragItem.current = null;
                dragOverItem.current = null;
            };

            return (
                <div className="relative z-10 w-full">
                    {/* Main Container */}
                    <div className={`rounded-xl shadow-[8px_8px_0px_0px_rgba(0,0,0,0.2)] border-[3px] border-friends-ink overflow-hidden relative transition-all duration-300 ${bgImage ? 'bg-friends-paper/90 backdrop-blur-sm' : 'bg-friends-paper'}`}>
                        
                        {/* Header: Monica's Door Purple */}
                        <div className="bg-friends-purple p-6 border-b-[3px] border-friends-ink flex items-center justify-between relative overflow-hidden">
                            <div className="relative z-10">
                                {/* FRIENDS Style Logo Title */}
                                <h1 className="friends-font text-3xl font-black tracking-widest text-white drop-shadow-md flex items-center gap-1">
                                    T<span className="text-friends-yellow">·</span>O<span className="text-friends-red mx-1"> </span>D<span className="text-friends-yellow">·</span>O<span className="text-friends-red mx-1"> </span>L<span className="text-friends-yellow">·</span>I<span className="text-friends-yellow">·</span>S<span className="text-friends-yellow">·</span>T
                                </h1>
                            </div>
                            
                            <div className="flex gap-2 relative z-10 items-center">
                                {/* Toolbar */}
                                <div className="flex bg-white/20 rounded-lg p-1 gap-1 backdrop-blur-md">
                                    <button onClick={() => bgInputRef.current.click()} className="p-1.5 rounded hover:bg-white/30 text-white transition-colors" title="배경 이미지">
                                        <Icons.Image size={18} />
                                    </button>
                                    <input type="file" ref={bgInputRef} onChange={handleBgUpload} style={{display: 'none'}} accept="image/*" />
                                    
                                    <div className="w-px bg-white/30 mx-0.5"></div>

                                    <button onClick={exportData} className="p-1.5 rounded hover:bg-white/30 text-white transition-colors" title="내보내기">
                                        <Icons.Download size={18} />
                                    </button>
                                    <button onClick={() => fileInputRef.current.click()} className="p-1.5 rounded hover:bg-white/30 text-white transition-colors" title="불러오기">
                                        <Icons.Upload size={18} />
                                    </button>
                                    <input type="file" ref={fileInputRef} onChange={importData} style={{display: 'none'}} accept=".json" />
                                    
                                    <div className="w-px bg-white/30 mx-0.5"></div>
                                    
                                    <button onClick={resetData} className="p-1.5 rounded hover:bg-white/30 text-white transition-colors" title="초기화">
                                        <Icons.Refresh size={18} />
                                    </button>
                                </div>
                                {/* Coffee Icon Badge */}
                                <div className="hidden sm:flex h-12 w-12 bg-friends-paper rounded-full items-center justify-center border-2 border-friends-ink shadow-lg ml-2 text-friends-purple">
                                    <Icons.Coffee size={24} />
                                </div>
                            </div>
                        </div>

                        {/* Input Area */}
                        <div className="p-5 bg-friends-paper border-b-[3px] border-friends-ink relative">
                            {/* Decorative Colored Stripe */}
                            <div className="absolute top-0 left-0 w-full h-1.5 bg-gradient-to-r from-friends-red via-friends-yellow to-friends-purple"></div>
                            
                            <form onSubmit={addTodo} className="flex flex-col gap-3 mt-2">
                                <input type="text" value={inputText} onChange={(e) => setInputText(e.target.value)} placeholder="How you doin? (할 일을 입력하세요)" className="todo-text w-full bg-white border-[2px] border-friends-ink px-4 py-3 text-lg focus:outline-none focus:ring-4 focus:ring-friends-yellow/50 placeholder-gray-400 rounded-lg transition-all" />
                                <div className="flex gap-2">
                                    <div className="relative flex-1 group">
                                        <div className="absolute left-3 top-1/2 transform -translate-y-1/2 text-friends-ink/50"><Icons.Clock size={18} /></div>
                                        <input type="date" value={deadline} onChange={(e) => setDeadline(e.target.value)} className="w-full bg-white border-[2px] border-friends-ink pl-10 pr-3 py-2.5 focus:outline-none focus:ring-4 focus:ring-friends-yellow/50 text-sm rounded-lg transition-all font-bold text-friends-ink" />
                                    </div>
                                    <button type="submit" className="bg-friends-red text-white px-5 py-2 border-[2px] border-friends-ink rounded-lg font-bold hover:bg-[#c43c25] active:translate-y-0.5 transition-all flex items-center gap-2 shadow-[2px_2px_0px_0px_rgba(45,45,45,1)]"><Icons.Plus size={20} /></button>
                                </div>
                            </form>
                        </div>

                        {/* List Area */}
                        <div className={`min-h-[300px] relative transition-colors duration-300 ${bgImage ? 'bg-friends-paper/50' : 'bg-friends-paper'}`}>
                            {/* Note lines pattern */}
                            <div className="absolute inset-0 pointer-events-none opacity-50" style={{ backgroundImage: 'linear-gradient(transparent 29px, #e5e7eb 30px)', backgroundSize: '100% 30px', marginTop: '10px' }}></div>
                            
                            <ul className="relative z-10 p-4 space-y-3">
                                {todos.map((todo, index) => (
                                    <li key={todo.id} draggable onDragStart={(e) => handleDragStart(e, index)} onDragEnter={(e) => handleDragEnter(e, index)} onDragEnd={handleDragEnd} onDragOver={(e) => e.preventDefault()} 
                                        className={`group relative flex items-start gap-3 p-3 rounded-lg border-b-2 transition-all duration-200 cursor-default ${todo.completed ? 'bg-gray-100/50 border-transparent opacity-60' : 'bg-white border-friends-ink shadow-[3px_3px_0px_0px_rgba(244,211,94,1)] hover:-translate-y-0.5'}`}>
                                        <div className="cursor-move pt-1.5 text-gray-300 group-hover:text-friends-ink transition-colors"><Icons.Grip size={18} /></div>
                                        
                                        {/* [번호 표기 변경] 1. (밑줄) */}
                                        <div className="flex-shrink-0 pt-0.5">
                                            <span className="font-black text-friends-ink border-b-4 border-friends-yellow text-lg leading-none inline-block min-w-[1.5rem] text-center todo-text">
                                                {index + 1}.
                                            </span>
                                        </div>

                                        <div className="flex-1 min-w-0 pt-1">
                                            <div className="flex justify-between items-start">
                                                <span className={`todo-text text-lg font-bold leading-tight transition-all duration-300 ${todo.completed ? 'line-through decoration-friends-red decoration-[3px] text-gray-400' : 'text-friends-ink'}`}>{todo.text}</span>
                                                <button onClick={() => deleteTodo(todo.id)} className="opacity-0 group-hover:opacity-100 text-friends-red hover:bg-friends-red/10 rounded p-1 transition-all"><Icons.Trash size={16} /></button>
                                            </div>
                                            {todo.deadline && <div className="flex items-center gap-1.5 text-xs font-bold mt-1.5 text-friends-purple"><Icons.Calendar size={12} /><span className="tracking-wide">{todo.deadline}</span></div>}
                                        </div>
                                        <button onClick={() => toggleComplete(todo.id)} className={`flex-shrink-0 w-8 h-8 border-[2px] border-friends-ink rounded flex items-center justify-center transition-all ${todo.completed ? 'bg-friends-green border-friends-ink shadow-none' : 'bg-white hover:bg-friends-yellow/20 shadow-[2px_2px_0px_0px_rgba(45,45,45,0.2)]'}`}>{todo.completed && <Icons.Check size={20} className="text-white" strokeWidth={4} />}</button>
                                    </li>
                                ))}
                                {todos.length === 0 && <li className="text-center py-10 opacity-40 friends-font text-xl text-friends-ink">I'll be there for you...<br/><span className="text-sm font-sans">(할 일을 추가해주세요!)</span></li>}
                            </ul>
                        </div>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>