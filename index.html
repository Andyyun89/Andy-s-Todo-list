<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Retro Tasks (Auto-Save)</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Courier+Prime:wght@400;700&display=swap');
        body { font-family: 'Courier Prime', monospace; }
        .drag-over { opacity: 0.5; }
    </style>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        retro: {
                            bg: '#e6e0d4', paper: '#fff9ee', ink: '#2c241b',
                            accent: '#e07a5f', secondary: '#3d405b', highlight: '#f2cc8f', green: '#81b29a'
                        }
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-retro-bg min-h-screen flex items-center justify-center text-retro-ink selection:bg-retro-accent selection:text-white">

    <div id="root" class="w-full max-w-md p-4"></div>

    <script type="text/babel">
        const { useState, useRef, useEffect } = React;

        const Icons = {
            Plus: ({size=24}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>,
            Trash: ({size=24}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>,
            Check: ({size=24}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="4" strokeLinecap="round" strokeLinejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>,
            Clock: ({size=24}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>,
            Grip: ({size=24}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="9" cy="12" r="1"></circle><circle cx="9" cy="5" r="1"></circle><circle cx="9" cy="19" r="1"></circle><circle cx="15" cy="12" r="1"></circle><circle cx="15" cy="5" r="1"></circle><circle cx="15" cy="19" r="1"></circle></svg>,
            Calendar: ({size=24}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>,
            Refresh: ({size=24}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M23 4v6h-6"></path><path d="M1 20v-6h6"></path><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path></svg>
        };

        const INITIAL_TODOS = [
            { id: 1, text: "LP판 사러 가기", deadline: "2024-10-25", completed: false },
            { id: 3, text: "재즈 댄스 파티", deadline: "2024-10-31", completed: false },
            { id: 2, text: "오래된 라디오 수리", deadline: "2024-10-26", completed: true },
        ];

        function App() {
            // 1. 저장된 데이터 불러오기 (없으면 초기값 사용)
            const [todos, setTodos] = useState(() => {
                const saved = localStorage.getItem('retro_todos');
                return saved ? JSON.parse(saved) : INITIAL_TODOS;
            });
            const [inputText, setInputText] = useState("");
            const [deadline, setDeadline] = useState("");
            
            const dragItem = useRef(null);
            const dragOverItem = useRef(null);

            // 2. 데이터가 변할 때마다 자동 저장
            useEffect(() => {
                localStorage.setItem('retro_todos', JSON.stringify(todos));
            }, [todos]);

            const addTodo = (e) => {
                e.preventDefault();
                if (!inputText.trim()) return;
                const newTodo = { id: Date.now(), text: inputText, deadline: deadline, completed: false };
                setTodos([newTodo, ...todos]);
                setInputText("");
                setDeadline("");
            };

            const toggleComplete = (id) => {
                setTodos(todos.map(todo => todo.id === id ? { ...todo, completed: !todo.completed } : todo));
            };

            const deleteTodo = (id) => {
                if(confirm('이 할 일을 삭제하시겠습니까?')) {
                    setTodos(todos.filter(todo => todo.id !== id));
                }
            };

            const resetData = () => {
                if(confirm('모든 데이터를 초기화하시겠습니까?')) {
                    setTodos(INITIAL_TODOS);
                }
            };

            const handleDragStart = (e, index) => { dragItem.current = index; };
            const handleDragEnter = (e, index) => { dragOverItem.current = index; };
            const handleDragEnd = () => {
                if (dragItem.current !== null && dragOverItem.current !== null) {
                    const _todos = [...todos];
                    const draggedItemContent = _todos.splice(dragItem.current, 1)[0];
                    _todos.splice(dragOverItem.current, 0, draggedItemContent);
                    setTodos(_todos);
                }
                dragItem.current = null;
                dragOverItem.current = null;
            };

            return (
                <div className="relative z-10">
                    <div className="bg-retro-paper rounded-xl shadow-[12px_12px_0px_0px_rgba(44,36,27,1)] border-[3px] border-retro-ink overflow-hidden relative">
                        
                        {/* Header */}
                        <div className="bg-retro-accent p-6 border-b-[3px] border-retro-ink flex items-center justify-between relative overflow-hidden">
                            <div className="absolute top-0 left-0 w-full h-full opacity-10" style={{ backgroundImage: 'repeating-linear-gradient(45deg, #000 0, #000 1px, transparent 0, transparent 50%)', backgroundSize: '10px 10px' }}></div>
                            <div className="relative z-10">
                                <h1 className="text-4xl font-black tracking-tight uppercase text-retro-paper transform -rotate-1 drop-shadow-md" style={{ textShadow: '3px 3px 0px #2c241b' }}>Tasks</h1>
                                <p className="text-retro-ink text-xs font-bold bg-retro-paper inline-block px-2 py-0.5 mt-2 rounded-sm border border-retro-ink shadow-[2px_2px_0px_0px_rgba(44,36,27,0.5)]">PROJECT: DAILY LIFE</p>
                            </div>
                            <div className="flex gap-2">
                                <button onClick={resetData} className="bg-white/20 p-2 rounded-full hover:bg-white/40 text-retro-paper transition-colors" title="초기화">
                                    <Icons.Refresh size={20} />
                                </button>
                                <div className="h-14 w-14 bg-retro-secondary rounded-full flex items-center justify-center border-[3px] border-retro-paper shadow-lg transform rotate-12">
                                    <Icons.Check size={32} className="text-retro-paper" />
                                </div>
                            </div>
                        </div>

                        {/* Input */}
                        <div className="p-5 bg-retro-highlight border-b-[3px] border-retro-ink">
                            <form onSubmit={addTodo} className="flex flex-col gap-3">
                                <input type="text" value={inputText} onChange={(e) => setInputText(e.target.value)} placeholder="할 일을 입력하세요..." className="w-full bg-retro-paper border-[2px] border-retro-ink px-4 py-3 text-lg focus:outline-none focus:ring-4 focus:ring-retro-accent/50 placeholder-retro-ink/40 rounded-lg transition-all" />
                                <div className="flex gap-2">
                                    <div className="relative flex-1 group">
                                        <div className="absolute left-3 top-1/2 transform -translate-y-1/2 text-retro-ink/60"><Icons.Clock size={18} /></div>
                                        <input type="date" value={deadline} onChange={(e) => setDeadline(e.target.value)} className="w-full bg-retro-paper border-[2px] border-retro-ink pl-10 pr-3 py-2.5 focus:outline-none focus:ring-4 focus:ring-retro-accent/50 text-sm rounded-lg transition-all font-bold text-retro-ink/80" />
                                    </div>
                                    <button type="submit" className="bg-retro-secondary text-retro-paper px-5 py-2 border-[2px] border-retro-ink rounded-lg font-bold hover:bg-[#2e3146] active:translate-y-0.5 transition-all flex items-center gap-2 shadow-[3px_3px_0px_0px_rgba(44,36,27,1)]"><Icons.Plus size={20} /></button>
                                </div>
                            </form>
                        </div>

                        {/* List */}
                        <div className="bg-retro-paper min-h-[300px] relative">
                            <div className="absolute inset-0 pointer-events-none" style={{ backgroundImage: 'linear-gradient(transparent 27px, #e5e5e5 28px)', backgroundSize: '100% 28px', marginTop: '14px' }}></div>
                            <ul className="relative z-10 p-4 space-y-3">
                                {todos.map((todo, index) => (
                                    <li key={todo.id} draggable onDragStart={(e) => handleDragStart(e, index)} onDragEnter={(e) => handleDragEnter(e, index)} onDragEnd={handleDragEnd} onDragOver={(e) => e.preventDefault()} 
                                        className={`group relative flex items-start gap-3 p-3 rounded-lg border-[2px] transition-all duration-200 cursor-default ${todo.completed ? 'bg-[#e5e5e5]/30 border-transparent opacity-70' : 'bg-white border-retro-ink shadow-[4px_4px_0px_0px_rgba(224,122,95,0.3)] hover:shadow-[4px_4px_0px_0px_rgba(224,122,95,1)] hover:-translate-y-0.5'}`}>
                                        <div className="cursor-move pt-1.5 text-retro-ink/20 group-hover:text-retro-ink transition-colors"><Icons.Grip size={18} /></div>
                                        <div className="flex-1 min-w-0 pt-0.5">
                                            <div className="flex justify-between items-start">
                                                <span className={`text-lg font-bold leading-tight transition-all duration-300 ${todo.completed ? 'line-through decoration-retro-accent decoration-[3px] text-retro-ink/40' : 'text-retro-ink'}`}>{todo.text}</span>
                                                <button onClick={() => deleteTodo(todo.id)} className="opacity-0 group-hover:opacity-100 text-retro-accent hover:text-[#d05030] transition-opacity ml-2 p-1"><Icons.Trash size={16} /></button>
                                            </div>
                                            {todo.deadline && <div className="flex items-center gap-1.5 text-xs font-bold mt-1.5 text-retro-green"><Icons.Calendar size={12} /><span className="tracking-wide">{todo.deadline}</span></div>}
                                        </div>
                                        <button onClick={() => toggleComplete(todo.id)} className={`flex-shrink-0 w-7 h-7 border-[2px] border-retro-ink rounded flex items-center justify-center transition-all shadow-[2px_2px_0px_0px_rgba(44,36,27,0.2)] ${todo.completed ? 'bg-retro-green border-retro-ink' : 'bg-white hover:bg-retro-highlight'}`}>{todo.completed && <Icons.Check size={18} className="text-retro-paper" />}</button>
                                        {todo.completed && <div className="absolute left-1/2 top-1/2 transform -translate-x-1/2 -translate-y-1/2 -rotate-[15deg] pointer-events-none z-20"><div className="border-[3px] border-retro-accent text-retro-accent px-3 py-1 text-lg font-black uppercase tracking-widest opacity-90 animate-pulse" style={{ mixBlendMode: 'multiply' }}>DONE</div></div>}
                                    </li>
                                ))}
                                {todos.length === 0 && <li className="text-center py-10 opacity-40 font-bold tracking-widest text-retro-ink">NO TASKS YET...</li>}
                            </ul>
                        </div>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>